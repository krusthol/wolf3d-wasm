NAME = kimkam
EM_NAME = index.html
EM_OUT_DIR = out
EM_TEMPLATE = html_template/minimal.html
CFLAGS = -Iinclude -g
ASSETS = assets
EM_FLAGS = -s USE_SDL=2 -s USE_SDL_IMAGE=2 -s SDL2_IMAGE_FORMATS='["png"]' -s USE_SDL_TTF=2 --preload-file $(ASSETS) --shell-file $(EM_TEMPLATE)
LIBS = -lSDL2 -lSDL2_ttf -lSDL2_image
SRC = $(wildcard src/*.c)
OBJ = $(subst .c,.o,$(SRC))

all: $(NAME)

emcc:
	@emcc $(EM_FLAGS) $(OBJ) -o $(EM_OUT_DIR)/$(EM_NAME)

web: emcc
	python3 -m http.server & google-chrome-stable http://0.0.0.0:8000/$(EM_OUT_DIR)/$(EM_NAME)

$(NAME): $(OBJ)
	@gcc $(CFLAGS) $(OBJ) $(LIBS) -o $(NAME)

clean:
	@rm -f $(OBJ)

fclean: clean
	@rm -f $(NAME)

emclean: clean
	@rm -f $(EM_OUT_DIR)/*

re: fclean all

.PHONY: all emcc web clean fclean emclean re
